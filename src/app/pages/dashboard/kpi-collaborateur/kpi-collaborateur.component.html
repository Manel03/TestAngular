<div id="pdfContent">
  <div id="kpiSection">
    <!-- ğŸ“Š Titre principal -->
    <h2 style="text-align: left">ğŸ“Š KPIs - Collaborateur</h2>

    <!-- ğŸ” Filtres -->
    <div class="filters-container">
      <div class="category-buttons">
        <button *ngFor="let cat of categories"
                (click)="setCategory(cat)"
                [class.active]="selectedCategory === cat">
          {{ cat }}
        </button>
      </div>
      <div class="filter-selects">
        <label>
          ğŸ—“ PÃ©riode :
          <select [(ngModel)]="selectedPeriod">
            <option value="7">7 derniers jours</option>
            <option value="30">30 derniers jours</option>
            <option value="90">3 derniers mois</option>
          </select>
        </label>

        <label>
          ğŸ“‚ CatÃ©gorie :
          <select [(ngModel)]="selectedCategory">
            <option value="">Toutes</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
          </select>
        </label>

        <button class="view-toggle-button" (click)="toggleView()">
          {{ viewMode === 'cards' ? 'ğŸ“‹ Voir en tableau' : 'ğŸ§¾ Voir en cartes' }}
        </button>
      </div>
    </div>

    <!-- ğŸ“Š Vue cartes -->
    <div *ngIf="viewMode === 'cards'" class="kpi-row" @fadeInOut>
      <div class="kpi-card" matTooltip="92% des collaborateurs reviennent suivre une formation">
        ğŸ” <strong>RÃ©tention :</strong> 92%
      </div>
      <div class="kpi-card" matTooltip="Les collaborateurs suivent une formation toutes les 7 jours en moyenne">
        â³ <strong>Temps moyen entre formations :</strong> 7 jours
      </div>
      <div class="kpi-card" matTooltip="AmÃ©lioration globale sur les derniers mois">
        ğŸ“ˆ <strong>Progression globale :</strong> +12%
      </div>
      <div class="kpi-card" matTooltip="Score basÃ© sur les Ã©valuations des formations">
        ğŸ§  <strong>Score dâ€™Ã©valuation :</strong> 76/100
      </div>
      <div class="kpi-card" matTooltip="Nombre moyen de formations suivies par mois">
        ğŸ“† <strong>FrÃ©quence mensuelle :</strong> 3.4 formations
      </div>
      <div class="kpi-card" matTooltip="Une formation est restÃ©e incomplÃ¨te">
        ğŸ”” <strong>Formations incomplÃ¨tes :</strong> 1
      </div>
    </div>

    <!-- ğŸ“‹ Vue tableau -->
    <div *ngIf="viewMode === 'table'" class="kpi-table-container" @fadeInOut>
      <table class="kpi-table">
        <thead>
          <tr>
            <th>Indicateur</th>
            <th>Valeur</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ğŸ” RÃ©tention</td>
            <td>92%</td>
            <td>92% des collaborateurs reviennent suivre une formation</td>
          </tr>
          <tr>
            <td>â³ Temps moyen entre formations</td>
            <td>7 jours</td>
            <td>DÃ©lai moyen entre deux formations</td>
          </tr>
          <tr>
            <td>ğŸ“ˆ Progression globale</td>
            <td>+12%</td>
            <td>AmÃ©lioration moyenne du parcours de formation</td>
          </tr>
          <tr>
            <td>ğŸ§  Score dâ€™Ã©valuation</td>
            <td>76/100</td>
            <td>BasÃ© sur les notes donnÃ©es en fin de formation</td>
          </tr>
          <tr>
            <td>ğŸ“† FrÃ©quence mensuelle</td>
            <td>3.4 formations</td>
            <td>Nombre moyen de formations mensuelles</td>
          </tr>
          <tr>
            <td>ğŸ”” Formations incomplÃ¨tes</td>
            <td>1</td>
            <td>Formations non finalisÃ©es par le collaborateur</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ğŸ” KPIs SupplÃ©mentaires -->
    <h3 class="kpi-sup-title">ğŸ” KPIs SupplÃ©mentaires</h3>
    <div class="kpi-row fade-in">
      <div class="kpi-card" *ngFor="let kpi of kpiFiltres">
        {{ kpi.icon }} <strong>{{ kpi.label }} :</strong> {{ kpi.value }}
      </div>
    </div>

    <!-- ğŸ“ˆ Progression mensuelle -->
    <div class="chart-container">
      <h3>ğŸ“ˆ Progression mensuelle</h3>
      <div id="completionChart" echarts [options]="completionChart" class="chart"></div>
    </div>

    <!-- ğŸ˜Š Taux de satisfaction -->
    <div class="chart-container">
      <h3>ğŸ˜Š Taux de satisfaction</h3>
      <div id="satisfactionChart" echarts [options]="satisfactionChart" class="chart"></div>
    </div>

    <!-- ğŸ¯ Score global et vue dynamique -->
    <button (click)="toggleView2()">
      ğŸ” Changer de vue : {{ viewMode2 === 'detailed' ? 'Camembert' : 'DÃ©tail' }}
    </button>

    <!-- Vue camembert -->
    <div *ngIf="viewMode2 === 'pie'" style="margin-top: 20px;">
      <div echarts [options]="pieOption" style="height: 300px;"></div>
    </div>

    <!-- Vue dÃ©taillÃ©e : score + barres -->
    <div *ngIf="viewMode2 === 'detailed'">
      <div class="score-block">
        <p>ğŸ¯ <strong>Score global</strong> : {{ score.valeur }}/100</p>
        <p>
          Seuil attendu : {{ score.seuil }} â€”
          <span [ngClass]="{ 'text-ok': score.valeur >= score.seuil, 'text-ko': score.valeur < score.seuil }">
            {{ score.valeur >= score.seuil ? 'âœ… OK' : 'âš ï¸ Ã€ amÃ©liorer' }}
          </span>
        </p>
      </div>

      <div class="module-block">
        <h4>ğŸ•’ Temps passÃ© par module</h4>
        <div *ngFor="let module of tempsParModule" class="module-item">
          <div class="module-header">
            <strong>{{ module.nom }} ({{ module.temps }}h / {{ module.objectif }}h)</strong>
            <span [ngClass]="{
              'badge-ok': module.temps >= module.objectif,
              'badge-warning': module.temps < module.objectif
            }">
              {{ module.temps >= module.objectif ? 'âœ… OK' : 'âš ï¸ Ã€ surveiller' }}
            </span>
          </div>

          <div class="bar-container">
            <div
              class="bar"
              [style.width.%]="(module.temps / module.objectif) * 100"
              [ngClass]="{
                'bar-ok': module.temps >= module.objectif,
                'bar-warning': module.temps < module.objectif && module.temps >= module.objectif / 2,
                'bar-critical': module.temps < module.objectif / 2
              }"
            ></div>
          </div>

          <div *ngIf="module.temps < module.objectif" class="reco">
            ğŸ“˜ Suggestion : <i>Planifier 1h par semaine pour {{ module.nom.toLowerCase() }}.</i>
            <br />
            <button class="btn-mini">ğŸ” AmÃ©liorer ce module</button>
          </div>
        </div>
      </div>

      <!-- ğŸ“„ RÃ©sumÃ© exportable -->
      <div class="export-box">
        ğŸ“„ <strong>RÃ©sumÃ© exportable</strong><br />
        Modules Ã  surveiller :
        <span *ngIf="getModulesASurveiller().length > 0">
          {{ getModulesASurveiller().join(', ') }}
        </span>
        <span *ngIf="getModulesASurveiller().length === 0">Aucun âœ…</span>
        <br />
        Recommandation : renforcer les modules en retard avant la fin du trimestre.
      </div>
    </div>
  </div>
</div>
