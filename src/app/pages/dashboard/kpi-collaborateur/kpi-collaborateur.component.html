
<div class="kpi-dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header" @fadeInOut>
    <div class="header-content">
      <h1 class="dashboard-title">
        <span class="title-icon">üìä</span>
        Tableau de Bord Collaborateur
      </h1>
      <p class="dashboard-subtitle">Suivi personnalis√© de votre parcours e-learning</p>
    </div>
    
    <div class="header-actions">
      <button class="action-btn primary" (click)="exportData()">
        <span class="btn-icon">üìÑ</span>
        Exporter
      </button>
      <button class="action-btn secondary" (click)="scheduleReview()">
        <span class="btn-icon">üìÖ</span>
        Planifier R√©vision
      </button>
    </div>
  </div>

  <!-- Control Panel -->
  <div class="control-panel" @slideIn>
    <div class="filters-section">
      <div class="filter-group">
        <label class="filter-label">üìÖ P√©riode</label>
        <select [(ngModel)]="selectedPeriod" class="filter-select">
          <option value="7">7 derniers jours</option>
          <option value="30">30 derniers jours</option>
          <option value="90">3 derniers mois</option>
          <option value="365">Ann√©e compl√®te</option>
        </select>
      </div>
      
      <div class="category-filters">
        <button 
          *ngFor="let cat of categories"
          (click)="setCategory(cat.name)"
          [class.active]="selectedCategory === cat.name"
          [style.--category-color]="cat.color"
          class="category-btn">
          <span class="category-icon">{{ cat.icon }}</span>
          {{ cat.name }}
        </button>
      </div>
    </div>

    <div class="view-controls">
      <div class="view-toggle">
        <button 
          (click)="toggleView()" 
          class="toggle-btn"
          [attr.data-view]="viewMode">
          {{ viewMode === 'dashboard' ? 'üìä Tableau de Bord' : 
             viewMode === 'cards' ? 'üÉè Vue Cartes' : 'üìã Vue Tableau' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Dashboard View -->
  <div *ngIf="viewMode === 'dashboard'" class="dashboard-view" @fadeInOut>
    <!-- KPI Summary Cards -->
    <div class="kpi-summary-grid">
      <div 
        *ngFor="let kpi of filteredKpiMetrics; trackBy: trackKpiById" 
        class="kpi-summary-card"
        @scaleIn>
        <div class="kpi-header">
          <div class="kpi-icon-container">
            <span class="kpi-icon">{{ kpi.icon }}</span>
          </div>
          <div class="kpi-trend">
            <span class="trend-icon">{{ getTrendIcon(kpi.trend) }}</span>
            <span class="trend-value" [class]="'trend-' + kpi.trend">
              {{ kpi.trendValue > 0 ? '+' : '' }}{{ kpi.trendValue }}%
            </span>
          </div>
        </div>
        
        <div class="kpi-content">
          <h3 class="kpi-title">{{ kpi.label }}</h3>
          <div class="kpi-value-container">
            <span class="kpi-value">{{ kpi.value }}{{ kpi.unit }}</span>
            <span class="kpi-target">Objectif: {{ kpi.target }}{{ kpi.unit }}</span>
          </div>
          
          <div class="kpi-progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="(kpi.value / kpi.target) * 100"
              [class.exceeded]="kpi.value > kpi.target">
            </div>
          </div>
          
          <p class="kpi-description">{{ kpi.description }}</p>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-controls">
        <button (click)="toggleChartView()" class="chart-toggle-btn">
          {{ chartView === 'detailed' ? 'üìä Vue D√©taill√©e' : 'üìà Vue R√©sum√©' }}
        </button>
      </div>

      <div *ngIf="chartView === 'detailed'" class="detailed-charts">
        <div class="chart-grid">
          <div class="chart-container">
            <div echarts [options]="progressChart" class="chart"></div>
          </div>
          
          <div class="chart-container">
            <div echarts [options]="skillsRadarChart" class="chart"></div>
          </div>
          
          <div class="chart-container">
            <div echarts [options]="timeDistributionChart" class="chart"></div>
          </div>
          
          <div class="chart-container">
            <div echarts [options]="performanceTrendChart" class="chart"></div>
          </div>
        </div>
      </div>

      <div *ngIf="chartView === 'summary'" class="summary-charts">
        <div class="summary-grid">
          <div class="chart-container large">
            <div echarts [options]="performanceTrendChart" class="chart"></div>
          </div>
          <div class="chart-container">
            <div echarts [options]="timeDistributionChart" class="chart"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Learning Modules Section -->
    <div class="modules-section">
      <h2 class="section-title">
        <span class="title-icon">üìö</span>
        Modules d'Apprentissage
      </h2>
      
      <div class="modules-grid">
        <div 
          *ngFor="let module of filteredLearningModules; trackBy: trackModuleById" 
          class="module-card"
          @scaleIn>
          <div class="module-header">
            <div class="module-info">
              <h3 class="module-title">{{ module.name }}</h3>
              <div class="module-meta">
                <span class="difficulty-badge">
                  {{ getDifficultyIcon(module.difficulty) }}
                  {{ module.difficulty }}
                </span>
                <span class="category-badge" [style.background-color]="getCategoryColor(module.category)">
                  {{ module.category }}
                </span>
              </div>
            </div>
            
            <div class="module-status" [style.color]="getStatusColor(module.status)">
              <span class="status-dot" [style.background-color]="getStatusColor(module.status)"></span>
              {{ getStatusLabel(module.status) }}
            </div>
          </div>
          
          <div class="module-progress">
            <div class="progress-info">
              <span class="progress-label">Progression</span>
              <span class="progress-percentage">{{ module.progress }}%</span>
            </div>
            <div class="progress-bar">
              <div 
                class="progress-fill" 
                [style.width.%]="module.progress"
                [style.background-color]="getStatusColor(module.status)">
              </div>
            </div>
          </div>
          
          <div class="module-time">
            <div class="time-info">
              <span class="time-spent">‚è±Ô∏è {{ module.timeSpent }}h pass√©es</span>
              <span class="time-target">üéØ {{ module.targetTime }}h objectif</span>
            </div>
            <div class="time-progress">
              <div 
                class="time-bar" 
                [style.width.%]="(module.timeSpent / module.targetTime) * 100"
                [class.over-target]="module.timeSpent > module.targetTime">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards View -->
  <div *ngIf="viewMode === 'cards'" class="cards-view" @fadeInOut>
    <div class="cards-grid">
      <div 
        *ngFor="let kpi of filteredKpiMetrics" 
        class="metric-card"
        @scaleIn>
        <div class="card-content">
          <div class="metric-header">
            <span class="metric-icon">{{ kpi.icon }}</span>
            <span class="metric-category">{{ kpi.category }}</span>
          </div>
          <h3 class="metric-title">{{ kpi.label }}</h3>
          <div class="metric-value">{{ kpi.value }}{{ kpi.unit }}</div>
          <div class="metric-target">Objectif: {{ kpi.target }}{{ kpi.unit }}</div>
          <div class="metric-trend">
            {{ getTrendIcon(kpi.trend) }} {{ kpi.trendValue }}%
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table View -->
  <div *ngIf="viewMode === 'table'" class="table-view" @fadeInOut>
    <div class="table-container">
      <table class="metrics-table">
        <thead>
          <tr>
            <th>Indicateur</th>
            <th>Valeur Actuelle</th>
            <th>Objectif</th>
            <th>Tendance</th>
            <th>Cat√©gorie</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let kpi of filteredKpiMetrics">
            <td>
              <span class="table-icon">{{ kpi.icon }}</span>
              {{ kpi.label }}
            </td>
            <td class="value-cell">{{ kpi.value }}{{ kpi.unit }}</td>
            <td class="target-cell">{{ kpi.target }}{{ kpi.unit }}</td>
            <td class="trend-cell">
              <span class="trend-indicator" [class]="'trend-' + kpi.trend">
                {{ getTrendIcon(kpi.trend) }} {{ kpi.trendValue }}%
              </span>
            </td>
            <td class="category-cell">{{ kpi.category }}</td>
            <td class="description-cell">{{ kpi.description }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
